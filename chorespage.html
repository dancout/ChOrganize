<html>

	<head>
	    <title>My Groups</title>

	    <!-- include stylesheets and bootstrap -->
	    <meta charset="utf-8">
	    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	     <!-- Optional theme -->
	    <link  href="https:///bootswatch.com/paper/bootstrap.min.css" Rel="stylesheet" id="bs-theme-stylesheet">

	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	   	<link rel="stylesheet" type="text/css" href="style.css">

	  	<!-- firebase -->
	   	<script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>

	</head>

<script>
  //this function sets the window location with the correct appeneded user, group, and choreItem values
	function dummy(choreName) {
    var UrlString = window.location.toString();
    var userIndex = UrlString.indexOf("?") + 1;   
    var UrlSubString = UrlString.substring(userIndex, UrlString.length);
    var choreUrl = "choreItem.html?";
    choreUrl = choreUrl.concat(UrlSubString);
    choreUrl = choreUrl.concat("&");
    choreUrl = choreUrl.concat(choreName);
		window.location.href=choreUrl;
	}

  //this function returns the firebase url with the correct children appended
  function firebaseUrl(choreName) {
    var UrlString = window.location.toString();
    var userIndex = UrlString.indexOf("?") + 1;  
    var rightIndex = UrlString.lastIndexOf("&"); 
    var leftUrlSubString = UrlString.substring(userIndex, rightIndex);   

    var groupIndex = UrlString.lastIndexOf("&") + 1;  
    var rightUrlSubString = UrlString.substring(groupIndex, UrlString.length);  

    var mainUrl = 'https://flickering-inferno-1570.firebaseio.com/Groups/';
    //var mainUrlGroup = mainUrl.concat(leftUrlSubString);
    //var mainUrlGroupSlash = mainUrlGroup.concat("/");
    var mainUrlChore = mainUrl.concat(rightUrlSubString);
    var mainUrlChoreFinal = mainUrlChore.concat("/Chores");
    if(choreName == null) {
      console.log("Inside Chore Name");
      return mainUrlChoreFinal;
    }
    mainUrlChoreFinal = mainUrlChoreFinal.concat(choreName);
    mainUrlChoreFinal = mainUrlChoreFinal.concat("/");
    return mainUrlChoreFinal;
  }

  function gotoGroupspage()
  {
    var UrlString = window.location.toString();
    UrlString = UrlString.replace("chorespage", "groupspage");
    var userIndex = UrlString.indexOf("?") + 1;   
    var UrlSubString = UrlString.substring(userIndex, UrlString.length);

    var subIndex = UrlSubString.indexOf("&");
    var UrlSubSubString = UrlSubString.substring(subIndex, UrlSubString.length);

    var UrlString = UrlString.replace(UrlSubSubString, "");
    window.location.href = UrlString;

  }

  function gotoHomepage()
  {
    var UrlString = window.location.toString();
    UrlString = UrlString.replace("chorespage", "homepage");
    var userIndex = UrlString.indexOf("?") + 1;   
    var UrlSubString = UrlString.substring(userIndex, UrlString.length);

    var subIndex = UrlSubString.indexOf("&");
    var UrlSubSubString = UrlSubString.substring(subIndex, UrlSubString.length);

    var UrlString = UrlString.replace(UrlSubSubString, "");
    window.location.href = UrlString;

  }
</script>


<script>
  //this function auto initalizes the data onto the page, when page is loaded
  $(document).ready(function () {
	  var myDataRef = new Firebase(firebaseUrl());
    //var myDataRef = new Firebase('https://flickering-inferno-1570.firebaseio.com/i/Group X/Chore X/');
    myDataRef.once('value', function(snapshot) {
      var hasChore = snapshot.hasChild("Dummy");
      if(hasChore == false) {
        var chores = snapshot.val();

        snapshot.forEach(function(data) {
        // create the button div
        var buttonDiv = document.createElement("div");
        var divName = data.key() + "Div"; // button div name, to be used for id
        buttonDiv.setAttribute("id", divName);

        // add button div to scrollingButtons
        document.getElementById("scrollingButtons").appendChild(buttonDiv);

        // create button
        var btn = document.createElement("BUTTON");
        btn.setAttribute("id", data.child("ChoreName").val());

        // create button's name, and add it on 
        var t = document.createTextNode(data.child("ChoreName").val());
        btn.appendChild(t);


        // add function to button click
        btn.onclick = function() {dummy(data.key());};

        // create radio button's form
        var buttonForm = document.createElement("FORM");
        formName = data.key() + "Form";
        buttonForm.setAttribute("id", formName);

        // check the status of which radio button should be checked
        var status;
        if(0 == data.child("Done").child("Done").val())
        {
          status = false;
        }
        else
        {
          status = true;
        }

        // create radio button
        var x = document.createElement("INPUT");
        x.setAttribute("type", "radio");
        x.setAttribute("name", "james");
        x.checked = !status;
        var radioName1 = data.child("ChoreName").val() + "b1";
        x.setAttribute("id", radioName1);
        x.onclick = function() {colorChange(data.child("ChoreName").val(), data.key());};
        x.setAttribute("class", "radioButtonLeft");

        // create 2nd radio button
        var y = document.createElement("INPUT");
        y.setAttribute("type", "radio");
        y.setAttribute("name", "james");
        var radioName2 = data.child("ChoreName").val() + "b2";
        y.setAttribute("id", radioName2);
        y.onclick = function() {colorChange(data.child("ChoreName").val(), data.key());};
        y.setAttribute("class", "radioButtonCenter");
        y.checked = status;


        // create 3rd radio button
        var z = document.createElement("INPUT");
        z.setAttribute("type", "radio");
        z.setAttribute("name", "james");
        var radioName2 = data.child("ChoreName").val() + "b3";
        z.setAttribute("id", radioName2);
        z.onclick = function() {removeChore(data.key());};        
        z.setAttribute("class", "radioButtonRight");


        // add button then button form to button div
        document.getElementById(divName).appendChild(btn);
        document.getElementById(divName).appendChild(buttonForm);

        // add radio buttons to formDiv
        document.getElementById(formName).appendChild(x);
        document.getElementById(formName).appendChild(y);
        document.getElementById(formName).appendChild(z);

        // update the color of the button
        colorChange(data.child("ChoreName").val(), data.key());

        });
      }
    });
    //adds buttons when new chore is added
    myDataRef.on('child_added', function(data, prevchildkey) {
        console.log(prevchildkey);


    });
  });


  function removeChore(choreName) {
    var choreNameWithSlash = "/";
    choreNameWithSlash = choreNameWithSlash.concat(choreName);
    var mainUrlChoreFinal = firebaseUrl(choreNameWithSlash);
    console.log(mainUrlChoreFinal);
    var newDataRef = new Firebase(mainUrlChoreFinal);

    // if last chore, add dummy first
    var index = mainUrlChoreFinal.lastIndexOf("/Chores");
    var subStringUrl = mainUrlChoreFinal.substring(0, index);
    subStringUrl = subStringUrl.concat("/Chores/");
    var dummyRef = new Firebase(subStringUrl);
    var deleteBool = true;

    dummyRef.once("value", function(snapshot){
      var num = snapshot.numchildren();

      if (num == 1)
      {
        dummyRef.set({Dummy: 0});
        deleteBool = false;
      }
      else
      {
        deleteBool = true;
      }
    });


    if(deleteBool)
    {
      newDataRef.remove();
    }
    window.location.href = window.location;
  }


  function colorChange(choreName, dKey) {
        if(document.getElementById(choreName + "b1").checked) // not complete
        {
          document.getElementById(choreName).style.backgroundColor = "#eb6d20";
          // update firebase "done" value to 0
          dummySlash = "/";
          dKey = dummySlash.concat(dKey);
          var choreUrl = firebaseUrl(dKey);

          choreUrl = choreUrl.concat("Done");

          var dataRef = new Firebase(choreUrl);
          var doneVal = 0;

          dataRef.update({Done: doneVal});

        }
        else if (document.getElementById(choreName + "b2").checked) // complete
        {
          document.getElementById(choreName).style.backgroundColor = "blue";

          // update firebase "done" value to 1

          dummySlash = "/";
          dKey = dummySlash.concat(dKey);
          var choreUrl = firebaseUrl(dKey);

          choreUrl = choreUrl.concat("Done");

          var dataRef = new Firebase(choreUrl);
          var doneVal = 1;

          dataRef.update({Done: doneVal});

        }
        else if (document.getElementById(choreName + "b3").checked){
          removeChore(choreName);
        }
        else {
          alert("you broke it");
        }
  }


  function addChore() {
	  //var myDataRef = new Firebase('https://flickering-inferno-1570.firebaseio.com/');
 // declares the button
   	var choreName = prompt("Please enter your chore name", "Chore X");
   	var choreDesc = prompt("Please enter your chore description", "Description");
   	var dueDate = prompt("Please enter your chore due date", "Due Date");


    var UrlString = window.location.toString();
    var userIndex = UrlString.indexOf("?") + 1;  
    var rightIndex = UrlString.lastIndexOf("&"); 
    var leftUrlSubString = UrlString.substring(userIndex, rightIndex); 

    var userDataRef = new Firebase(firebaseUrl());
    var newGroupChore = userDataRef.push();
    var doneVal = 0;
        newGroupChore.update({ChoreAssign: leftUrlSubString, ChoreDesc: choreDesc, 
          ChoreDueDate: dueDate, ChoreName: choreName, Done: {Done: doneVal}});

// adds script to button

    var leftIndex = newGroupChore.toString().lastIndexOf("/") + 1;
    var groupSubString = newGroupChore.toString().substring(leftIndex, newGroupChore.toString().length);
    //document.getElementById(choreName).onclick = function() {dummy(groupSubString);};

    userDataRef.once("value", function(snapshot) {
      var hasChore = snapshot.hasChild("Dummy");
      if(hasChore == true) {
        var removeDummyUrl = firebaseUrl();
        removeDummyUrl = removeDummyUrl.concat("/Dummy");
        var removeDummy = new Firebase(removeDummyUrl);
        removeDummy.remove();
      }
    });

    window.location.href=window.location;

  }


</script>

<body>
	<!-- wrapper around entire body -->
	<hr class="topline">
	<div id="wrapper">

		<!-- title bar header -->
		<div id="header">
			<div id="headerInner">
				<!-- makes a horizontal list hlding title and icons -->

				<ul class="nav nav-pills">

				<!-- Chorganize Title -->
				<li><img class="title" src="photos/ChOrganizelogo.png" onclick="gotoHomepage()"></li>


				<!-- Setting menu -->
			  	<li role="presentation" class="dropdown">
			    	<a class="dropdown-toggle" data-toggle="dropdown"
			    	role="button" aria-haspopup="true" aria-expanded="false">
			    	<img class="titlePic" src="photos/orangeGear.png"> <span class="caret"></span>
			    	</a>

				    <ul class="dropdown-menu">
				    	<li style="padding:15px;"><a>Page Layout</a></li>
				    	<li style="padding:15px;"><a>History</a></li>
				    	<li role="separator" class="divider"></li>
				    	<li style="padding:15px;"><a>General</a></li>
				    </ul>
			  	</li>

			  	<!-- User Profile Menu -->
			  	<li role="presentation" class="dropdown">
			    	<a class="dropdown-toggle" data-toggle="dropdown"
			    	role="button" aria-haspopup="true" aria-expanded="false">
			    	<img class="titlePic" src="photos/profilePic.png"> <span class="caret"></span>
			    	</a>

				    <ul class="dropdown-menu">
				    	<li style="padding:15px;"><a href="profilePage.html">Profile</a></li>
				    	<li style="padding:15px;"><a>Friends</a></li>
				    	<li style="padding:15px;"><a>Edit</a></li>
				    	<li role="separator" class="divider"></li>
				    	<li style="padding:15px;"><a href="login.html">Logout</a></li>
				    </ul>
			  	</li>

			  </ul>

				
			</div>
		</div>

		<hr class="bottomline">
		<h3 style="text-align:center;">My Chore List</h1>


		<!-- main buttons -->
		<div id="main">
			<ul>
				<!-- put a picture and a button in each 'list' item (row) -->
                <li><img class = "buttonPic" src="photos/backArrow.png"><button class="btn-default btn" onclick="gotoGroupspage()">Go Back</button></li>
				<li><img class = "buttonPic" src="photos/tennisBall.png"><button class="btn-default btn" onclick="addChore()">Add a new chore</button></li>
			</ul>



      <h4 style="text-align:center;"> My Chores</h4>


      <div id="scrollingButtons" class="btn-group-vertical" style="float:center">
        <p style="float:center;"> 
          <span style="display:inline-block; width: 45%;"></span> <img src="photos/checklist.png" style="width: 30px;"></img>
          <span style="display:inline-block; width: 15%;"></span> <img src="photos/checkmark.png" style="width: 30px;"></img>
          <span style="display:inline-block; width: 15%;"></span> <img src="photos/trashcan.png" style="width: 30px;"></img>
        </p>
      </div>

		</div>

	</div>

</body>

</html>
