<html>

	<head>
	    <title>My Profile</title>

	    <!-- include stylesheets and bootstrap -->
	    <meta charset="utf-8">
	    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	     <!-- Optional theme -->
	    <link  href="https:///bootswatch.com/paper/bootstrap.min.css" Rel="stylesheet" id="bs-theme-stylesheet">

	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	   	<link rel="stylesheet" type="text/css" href="style.css">
	   	
	   	<!-- firebase -->
	   	<script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
	</head>

	<script>
		function editUsername() {
			alert("hi");
		}

		function editEmail() {
			alert("helpme");
		}


		function getProfile(){
			var ref = new Firebase("https://flickering-inferno-1570.firebaseio.com/");
			var authData = ref.getAuth();

			var username = getUsername();

			if (authData) {
			  	//console.log("Authenticated user with uid:", authData.uid);
			  	// show email
				document.getElementById('email').innerHTML = authData.password.email;

				// find username
				var usersUrl = "https://flickering-inferno-1570.firebaseio.com/Users";
				var usersRef = new Firebase(usersUrl);

				usersRef.once("value", function(snapshot) {

					snapshot.forEach(function(childSnapshot) {
						if ( childSnapshot.child("UserInfo").child("Email").val() == authData.password.email )
							document.getElementById('username').innerHTML = childSnapshot.child("UserInfo").child("username").val();
					});
				});
			}
			else
			{
				document.getElementById('email').innerHTML = "No Email ):";
			}
		}
	</script>

	<!-- Function returns username -->
	<script>
		function getUsername() {
			var ref = new Firebase("https://flickering-inferno-1570.firebaseio.com/");
			var authData = ref.getAuth();

			if (authData) {
				// find username
				var usersUrl = "https://flickering-inferno-1570.firebaseio.com/Users";
				var usersRef = new Firebase(usersUrl);

				usersRef.once("value", function(snapshot) {

					snapshot.forEach(function(childSnapshot) {
						if ( childSnapshot.child("UserInfo").child("Email").val() == authData.password.email ) {
							//var username = childShapshot.key();
							var username = childSnapshot.child("UserInfo").child("username").val();
							alert ("hi " + username);
							return username;
						}
					});
				});
			}
			else {
				return false;
			}
		}
	</script>

	<!-- For login sensitive pages! -->
	<!-- Be sure to encompass the body with a div id="body" -->
	<script>
		function gotoLogin() {
			window.location.href="login.html?";
		}
		function gotoRegister() {
			window.location.href="register.html?";
		}
		function loginCheck(){
			var ref = new Firebase("https://flickering-inferno-1570.firebaseio.com/");
			var authData = ref.getAuth();

			if (authData) {
				// Insert any function you want here
				getProfile();
			}
			else
			{
				document.getElementById('body').innerHTML = "<h3><center>You are not logged in</center></h3>" + 
				"<center><button class='btn-default btn' onclick='gotoLogin()'>Login</button></center>" +
				"<br><center><button class='btn-default btn' onclick='gotoRegister()'>Register</button></center>"; 
			}		
		}
	</script>

	<script>
	  function logout(){
	  	var ref = new Firebase("https://flickering-inferno-1570.firebaseio.com/");
		ref.unauth();
	  }
	</script>

	<body onload="loginCheck()">
    <body>

		<hr class="topline">
		<div id="wrapper">
			
					<!-- title bar header -->
			<div id="header">
				<div id="headerInner">
					<!-- makes a horizontal list hlding title and icons -->

					<ul class="nav nav-pills">

					<!-- Chorganize Title -->
					<li><a href="homepage.html"><img class="title" src="photos/ChOrganizelogo.png"></a></li>


					<!-- Setting menu -->
				  	<li role="presentation" class="dropdown">
				    	<a class="dropdown-toggle" data-toggle="dropdown" 
				    	role="button" aria-haspopup="true" aria-expanded="false">
				    	<img class="titlePic" src="photos/orangeGear.png"> <span class="caret"></span>
				    	</a>

					    <ul class="dropdown-menu">
					    	<li style="padding:15px;"><a>Page Layout</a></li>
					    	<li style="padding:15px;"><a>History</a></li>
					    	<li role="separator" class="divider"></li>
					    	<li style="padding:15px;"><a>General</a></li>
					    </ul>
				  	</li>

				  	<!-- User Profile Menu -->
				  	<li role="presentation" class="dropdown">
				    	<a class="dropdown-toggle" data-toggle="dropdown" 
				    	role="button" aria-haspopup="true" aria-expanded="false">
				    	<img class="titlePic" src="photos/profilePic.png"> <span class="caret"></span>
				    	</a>

					    <ul class="dropdown-menu">
					    	<li style="padding:15px;"><a href="profilePage.html">Profile</a></li>
					    	<li style="padding:15px;"><a>Friends</a></li>
					    	<li style="padding:15px;"><a>Edit</a></li>
					    	<li role="separator" class="divider"></li>
					    	<li style="padding:15px;"><a href="login.html" onclick="logout()">Logout</a></li>
					    </ul>
				  	</li>

				  </ul>

					
				</div>
			</div> <center>
			<div id="body">
				<h3>Profile</h3>
				<img src="photos/profilePic.Png">
				<br>
				<br>
				<div id="table">
					<table style="width:40%">
						<tr>
							<td><strong>Email</strong></td>
							<td><div id="email"><div></td> 
							<td><button type="button" class="btn btn-default" onclick="editEmail()"> edit </button></td>
						</tr>
						<tr>
							<td><strong>Username</strong></td>
							<td><div id="username"><div></td> 
							<td><button type="button" class="btn btn-default" onclick="editUsername()">edit</button></td>
						</tr>
					</table>
				</div>
			</div> </center>
		</div>
	</body>

</html>
